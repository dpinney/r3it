{% extends "base.html" %}

{% block head %}
    <!-- Library Imports -->
    <script>sampleData = {{ eng_data | tojson }} </script>
{% endblock %}

{% block content %}
    
    <h1 class="my-4">Interconnection report for request {{data['ID']}}</h1>
    <hr class="my-4">

    {% if (
        ('engineer' in current_user.roles) or 
        ('memberServices' in current_user.roles)
    ) %}
        {{notes()}}
    {% endif %}

    {% if ( 
        (current_user.roles == []) and 
        (current_user.is_authenticated) and 
        (data['Status'] == 'Delegation Required')
    ) %}

        <div class="alert alert-warning">
            <h3 class="mb-3 alert-heading">Delegation Required</h3>
            <p>The contractor is not curently authorized to communicate about this application on the member's behalf. An email was sent to the member email associated with this account containing a link to provide the approval. If the member did not receive the email, or would like us to resend it, please ensure the member email in the 'Application Details' below is correct, and then click the "Send Delegation Email' button below.</p>
            <a class="btn btn-warning" href="{{'/sendDelegationEmail/' + data['ID'] }}" role="button">
                Send Delegation Email
            </a>
        </div>
        <hr class="my-4">
       
    {% endif %}

    <script type="text/javascript">
        window.onload = () => {
            const phones = document.querySelectorAll(".phone")
            phones.forEach((elem) => elem.textContent = VMasker.toPattern(elem.textContent, "(999) 999 - 9999"))
        }
    </script>

    <div class="my-4">
        <h2 class="my-4">Application Details</h2>

        <div class="row g-4">
            <div class="col-lg-6">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Member</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Name</div>
                                <div class="text-end">{{data['Name (Member)']}}</div>
                            </div>
                            {% if 'Name (Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Name (Member)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Mailing Address</div>
                                <div class="text-end">
                                    {{data['Address (Member)']}}<br>
                                    {% if data['Address 2 (Member)'] %}
                                        {{data['Address 2 (Member)']}}<br>
                                    {% endif %}
                                    {{data['City (Member)']}}, {{data['State (Member)']}}<br>
                                    {{data['Zip (Member)']}}
                                </div>
                            </div>
                            {% if 'Address (Member)' in edits 
                                or 'Address 2 (Member)' in edits
                                or 'City (Member)' in edits
                                or 'State (Member)' in edits
                                or 'Zip (Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">
                                    {% if 'Address (Member)' in edits %}{{edits['Address (Member)']}}<br>{% else %}{{data['Address (Member)']}}<br>{% endif %}
                                    {% if 'Address 2 (Member)' in edits %}{{edits['Address 2 (Member)']}}<br>{% elif 'Address 2 (Member)' in data %}{{data['Address 2 (Member)']}}<br>{% endif %}
                                    {% if 'City (Member)' in edits %}{{edits['City (Member)']}}, {% else %}{{data['City (Member)']}}, {% endif %}
                                    {% if 'State (Member)' in edits %}{{edits['State (Member)']}}{% else %}{{data['State (Member)']}}{% endif %}<br>
                                    {% if 'Zip (Member)' in edits%}{{edits['Zip (Member)']}}{% else %}{{data['Zip (Member)']}}{% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Email Address</div>
                                <div class="text-end">{{data['Email (Member)']}}</div>
                            </div>
                            {% if 'Email (Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Email (Member)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Primary Phone</div>
                                <div class="text-end phone">{{data['Phone (Primary, Member)']}}</div>
                            </div>
                            {% if 'Phone (Primary, Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Primary, Member)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Secondary Phone</div>
                                <div class="text-end phone">{{data['Phone (Secondary, Member)']}}</div>
                            </div>
                            {% if 'Phone (Secondary, Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Secondary, Member)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Fax Number</div>
                                <div class="text-end phone">{{data['Fax (Member)']}}</div>
                            </div>
                            {% if 'Fax (Member)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Fax (Member)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>

            {% if data['Name (Alt Contact)'] or edits['Name (Alt Contact)']
                or data['Address (Alt Contact)'] or edits['Address (Alt Contact)']
                or data['Address 2 (Alt Contact)'] or edits['Address 2 (Alt Contact)']
                or data['City (Alt Contact)'] or edits['City (Alt Contact)']
                or data['State (Alt Contact)'] or edits['State (Alt Contact)']
                or data['Zip (Alt Contact)'] or edits['Zip (Alt Contact)']
                or data['Email (Alt Contact)'] or edits['Email (Alt Contact)']
                or data['Phone (Primary, Alt Contact)'] or edits['Phone (Primary, Alt Contact)']
                or data['Phone (Secondary, Alt Contact)'] or edits['Phone (Secondary, Alt Contact)']
                or data['Fax (Alt Contact)'] or edits['Fax (Alt Contact)'] %}
            <div class="col-lg-6">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Alternate Contact</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Name</div>
                                <div class="text-end">{{data['Name (Alt Contact)']}}</div>
                            </div>
                            {% if 'Name (Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Name (Alt Contact)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Mailing Address</div>
                                <div class="text-end">
                                    {{data['Address (Alt Contact)']}}<br>
                                    {% if data['Address 2 (Alt Contact)'] %}
                                        {{data['Address 2 (Alt Contact)']}}<br>
                                    {% endif %}
                                    {{data['City (Alt Contact)']}}, {{data['State (Alt Contact)']}}<br>
                                    {{data['Zip (Alt Contact)']}}
                                </div>
                            </div>
                            {% if 'Address (Alt Contact)' in edits 
                                or 'Address 2 (Alt Contact)' in edits
                                or 'City (Alt Contact)' in edits
                                or 'State (Alt Contact)' in edits
                                or 'Zip (Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">
                                    {% if 'Address (Alt Contact)' in edits %}{{edits['Address (Alt Contact)']}}<br>{% else %}{{data['Address (Alt Contact)']}}<br>{% endif %}
                                    {% if 'Address 2 (Alt Contact)' in edits %}{{edits['Address 2 (Alt Contact)']}}<br>{% elif 'Address 2 (Alt Contact)' in data %}{{data['Address 2 (Alt Contact)']}}<br>{% endif %}
                                    {% if 'City (Alt Contact)' in edits %}{{edits['City (Alt Contact)']}}, {% else %}{{data['City (Alt Contact)']}}, {% endif %}
                                    {% if 'State (Alt Contact)' in edits %}{{edits['State (Alt Contact)']}}{% else %}{{data['State (Alt Contact)']}}{% endif %}<br>
                                    {% if 'Zip (Alt Contact)' in edits%}{{edits['Zip (Alt Contact)']}}{% else %}{{data['Zip (Alt Contact)']}}{% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Email Address</div>
                                <div class="text-end">{{data['Email (Alt Contact)']}}</div>
                            </div>
                            {% if 'Email (Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Email (Alt Contact)']}}</div>
                            </div>
                            {% endif %}
                        </li>
                        
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Primary Phone</div>
                                <div class="text-end phone">{{data['Phone (Primary, Alt Contact)']}}</div>
                            </div>
                            {% if 'Phone (Primary, Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Primary, Alt Contact)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Secondary Phone</div>
                                <div class="text-end phone">{{data['Phone (Secondary, Alt Contact)']}}</div>
                            </div>
                            {% if 'Phone (Secondary, Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Secondary, Alt Contact)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Fax Number</div>
                                <div class="text-end phone">{{data['Fax (Alt Contact)']}}</div>
                            </div>
                            {% if 'Fax (Alt Contact)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Fax (Alt Contact)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>
            {% endif %}

            <div class="col-lg-6">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Equipment Contractor</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Company Name</div>
                                <div class="text-end">{{data['Name (Contractor)']}}</div>
                            </div>
                            {% if 'Name (Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Name (Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Contact Person</div>
                                <div class="text-end">{{data['Contact Person (Contractor)']}}</div>
                            </div>
                            {% if 'Contact Person (Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Contact Person (Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Mailing Address</div>
                                <div class="text-end">
                                    {{data['Address (Contractor)']}}<br>
                                    {% if data['Address 2 (Contractor)'] %}
                                        {{data['Address 2 (Contractor)']}}<br>
                                    {% endif %}
                                    {{data['City (Contractor)']}}, {{data['State (Contractor)']}}<br>
                                    {{data['Zip (Contractor)']}}
                                </div>
                            </div>
                            {% if 'Address (Contractor)' in edits 
                                or 'Address 2 (Contractor)' in edits
                                or 'City (Contractor)' in edits
                                or 'State (Contractor)' in edits
                                or 'Zip (Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">
                                    {% if 'Address (Contractor)' in edits %}{{edits['Address (Contractor)']}}<br>{% else %}{{data['Address (Contractor)']}}<br>{% endif %}
                                    {% if 'Address 2 (Contractor)' in edits %}{{edits['Address 2 (Contractor)']}}<br>{% elif 'Address 2 (Contractor)' in data %}{{data['Address 2 (Contractor)']}}<br>{% endif %}
                                    {% if 'City (Contractor)' in edits %}{{edits['City (Contractor)']}}, {% else %}{{data['City (Contractor)']}}, {% endif %}
                                    {% if 'State (Contractor)' in edits %}{{edits['State (Contractor)']}}{% else %}{{data['State (Contractor)']}}{% endif %}<br>
                                    {% if 'Zip (Contractor)' in edits%}{{edits['Zip (Contractor)']}}{% else %}{{data['Zip (Contractor)']}}{% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Email Address</div>
                                <div class="text-end">{{data['Email (Contractor)']}}</div>
                            </div>
                            {% if 'Email (Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Email (Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Primary Phone</div>
                                <div class="text-end phone">{{data['Phone (Primary, Contractor)']}}</div>
                            </div>
                            {% if 'Phone (Primary, Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Primary, Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Secondary Phone</div>
                                <div class="text-end phone">{{data['Phone (Secondary, Contractor)']}}</div>
                            </div>
                            {% if 'Phone (Secondary, Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Secondary, Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Fax Number</div>
                                <div class="text-end phone">{{data['Fax (Contractor)']}}</div>
                            </div>
                            {% if 'Fax (Contractor)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Fax (Contractor)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Docket Number</div>
                                <div class="text-end">{{data['Docket Number']}}</div>
                            </div>
                            {% if 'Docket Number' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Docket Number']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>

            <div class="col-lg-6">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Electrical Contractor</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Company Name</div>
                                <div class="text-end">{{data['Name (Electrician)']}}</div>
                            </div>
                            {% if 'Name (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Name (Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Contact Person</div>
                                <div class="text-end">{{data['Contact Person (Electrician)']}}</div>
                            </div>
                            {% if 'Contact Person (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Contact Person (Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Mailing Address</div>
                                <div class="text-end">
                                    {{data['Address (Electrician)']}}<br>
                                    {% if data['Address 2 (Electrician)'] %}
                                        {{data['Address 2 (Electrician)']}}<br>
                                    {% endif %}
                                    {{data['City (Electrician)']}}, {{data['State (Electrician)']}}<br>
                                    {{data['Zip (Electrician)']}}
                                </div>
                            </div>
                            {% if 'Address (Electrician)' in edits 
                                or 'Address 2 (Electrician)' in edits
                                or 'City (Electrician)' in edits
                                or 'State (Electrician)' in edits
                                or 'Zip (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">
                                    {% if 'Address (Electrician)' in edits %}{{edits['Address (Electrician)']}}<br>{% else %}{{data['Address (Electrician)']}}<br>{% endif %}
                                    {% if 'Address 2 (Electrician)' in edits %}{{edits['Address 2 (Electrician)']}}<br>{% elif 'Address 2 (Electrician)' in data %}{{data['Address 2 (Electrician)']}}<br>{% endif %}
                                    {% if 'City (Electrician)' in edits %}{{edits['City (Electrician)']}}, {% else %}{{data['City (Electrician)']}}, {% endif %}
                                    {% if 'State (Electrician)' in edits %}{{edits['State (Electrician)']}}{% else %}{{data['State (Electrician)']}}{% endif %}<br>
                                    {% if 'Zip (Electrician)' in edits%}{{edits['Zip (Electrician)']}}{% else %}{{data['Zip (Electrician)']}}{% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Email Address</div>
                                <div class="text-end">{{data['Email (Electrician)']}}</div>
                            </div>
                            {% if 'Email (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Email (Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Primary Phone</div>
                                <div class="text-end phone">{{data['Phone (Primary, Electrician)']}}</div>
                            </div>
                            {% if 'Phone (Primary, Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Primary, Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Secondary Phone</div>
                                <div class="text-end phone">{{data['Phone (Secondary, Electrician)']}}</div>
                            </div>
                            {% if 'Phone (Secondary, Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Phone (Secondary, Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Fax Number</div>
                                <div class="text-end phone">{{data['Fax (Electrician)']}}</div>
                            </div>
                            {% if 'Fax (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end phone">{{edits['Fax (Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">License Number</div>
                                <div class="text-end">{{data['License (Electrician)']}}</div>
                            </div>
                            {% if 'License (Electrician)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['License (Electrician)']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>
            
            <div class="col-lg-6">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Interconnection Service</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Account Number</div>
                                <div class="text-end">{{data['Account Number']}}</div>
                            </div>
                            {% if 'Account Number' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Account Number']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Meter ID</div>
                                <div class="text-end">{{data['Meter ID']}}</div>
                            </div>
                            {% if 'Meter ID' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Meter ID']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Property Owner</div>
                                <div class="text-end">{{data['Owner']}}</div>
                            </div>
                            {% if 'Owner' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Owner']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Service Address</div>
                                <div class="text-end">
                                    {{data['Address (Service)']}}<br>
                                    {% if data['Address 2 (Service)'] %}
                                        {{data['Address 2 (Service)']}}<br>
                                    {% endif %}
                                    {{data['City (Service)']}}, {{data['State (Service)']}}<br>
                                    {{data['Zip (Service)']}}
                                </div>
                            </div>
                            {% if 'Address (Service)' in edits 
                                or 'Address 2 (Service)' in edits
                                or 'City (Service)' in edits
                                or 'State (Service)' in edits
                                or 'Zip (Service)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">
                                    {% if 'Address (Service)' in edits %}{{edits['Address (Service)']}}<br>{% else %}{{data['Address (Service)']}}<br>{% endif %}
                                    {% if 'Address 2 (Service)' in edits %}{{edits['Address 2 (Service)']}}<br>{% elif 'Address 2 (Service)' in data %}{{data['Address 2 (Service)']}}<br>{% endif %}
                                    {% if 'City (Service)' in edits %}{{edits['City (Service)']}}, {% else %}{{data['City (Service)']}}, {% endif %}
                                    {% if 'State (Service)' in edits %}{{edits['State (Service)']}}{% else %}{{data['State (Service)']}}{% endif %}<br>
                                    {% if 'Zip (Service)' in edits%}{{edits['Zip (Service)']}}{% else %}{{data['Zip (Service)']}}{% endif %}
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Estimated Install Date</div>
                                <div class="text-end">{{data['Estimated Install Date']}}</div>
                            </div>
                            {% if 'Estimated Install Date' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Estimated Install Date']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Estimated In-Service Date</div>
                                <div class="text-end">{{data['Estimated In-Service Date']}}</div>
                            </div>
                            {% if 'Estimated In-Service Date' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Estimated In-Service Date']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="fw-bold">Inverter</div>
                                    <div class="text-start fw-bold ps-3">Manufacturer<br>Model</div>
                                </div>
                                <div class="text-end">{{data['Inverter Manufacturer']}}<br>{{data['Inverter Model']}}</div>
                            </div>
                            {% if 'Inverter Manufacturer' in edits or 'Inverter Model' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="fw-bold">Update</div>
                                    <div class="text-start fw-bold ps-3">{% if 'Inverter Manufacturer' in edits %}Manufacturer<br>{% endif %}{% if 'Inverter Model' in edits %}Model{% endif %}</div>
                                </div>
                                <div class="text-end">{% if 'Inverter Manufacturer' in edits %}{{edits['Inverter Manufacturer']}}<br>{% endif %}{% if 'Inverter Model' in edits %}{{edits['Inverter Model']}}{% endif %}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Nameplate Ratings</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="text-end">{{data['Nameplate Rating (kW)']}}<br>{{data['Nameplate Rating (V)']}}</div>
                                    <div class="text-start fw-bold ps-2">kW-AC<br>V-AC</div>
                                </div>
                            </div>
                            {% if 'Nameplate Rating (kW)' in edits or 'Nameplate Rating (V)' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="d-flex justify-content-between align-items-center">
                                    <div class="text-end">{% if 'Nameplate Rating (kW)' in edits %}{{edits['Nameplate Rating (kW)']}}<br>{% endif %}{% if 'Nameplate Rating (V)' in edits %}{{edits['Nameplate Rating (V)']}}{% endif %}</div>
                                    <div class="text-start fw-bold ps-2">{% if 'Nameplate Rating (kW)' in edits %}kW-AC<br>{% endif %}{% if 'Nameplate Rating (V)' in edits %}V-AC{% endif %}</div>
                                </div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Inverter Phases</div>
                                <div class="text-end">{{data['Phases']}}</div>
                            </div>
                            {% if 'Phases' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Phases']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">UL1741 Listed</div>
                                <div class="text-end">{{data['UL1741 listed']}}</div>
                            </div>
                            {% if 'UL1741 listed' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['UL1741 listed']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Tariff Type</div>
                                <div class="text-end">{{data['Tariff']}}</div>
                            </div>
                            {% if 'Tariff' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Tariff']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>

            <div class="col">
                <div class="card text-center h-100">
                    <div class="card-header py-3">
                        <h3 class="card-title mb-0">Application Status</h3>
                    </div>

                    <ul class="list-group list-group-flush">
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Installation Type</div>
                                <div class="text-end">{{data['Installation Type']}}</div>
                            </div>
                            {% if 'Installation Type' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Installation Type']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Signed</div>
                                <div class="text-end">{{data['Signed']}}</div>
                            </div>
                            {% if 'Signed' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Signed']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Time of Request</div>
                                <div class="text-end">{{data['Time of Request']}}</div>
                            </div>
                            {% if 'Time of Request' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Time of Request']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">ID</div>
                                <div class="text-end">{{data['ID']}}</div>
                            </div>
                            {% if 'ID' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['ID']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Status</div>
                                <div class="text-end">{{data['Status']}}</div>
                            </div>
                            {% if 'Status' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Status']}}</div>
                            </div>
                            {% endif %}
                        </li>

                        {% if 'Previous Status' in data %}
                        <li class="list-group-item p-0">
                            <div class="d-flex justify-content-between align-items-center py-2 px-3">
                                <div class="fw-bold">Previous Status</div>
                                <div class="text-end">{{data['Previous Status']}}</div>
                            </div>
                            {% if 'Previous Status' in edits %}
                            <div class="d-flex justify-content-between align-items-center py-2 px-3 pending-update">
                                <div class="fw-bold">Update</div>
                                <div class="text-end">{{edits['Previous Status']}}</div>
                            </div>
                            {% endif %}
                        </li>
                        {% endif %}

                        <li class="list-group-item p-0"></li>
                    </ul>
                </div>
            </div>
        </div>

        


    </div>


    <!-- <table>
    
        {% if(edits != {}) %}
            <tr>
                <th></th>
                <th>Original</th>
                <th>Updated</th>
            </tr>
        {% endif %}

        {% for key in data %}
            
            {% if ( 
                (key != 'Notes') and 
                (key != 'Screen Results') and 
                (key != 'markedForRerunDueToWithdrawal') and
                (key != 'previousRequestWithdrawn') and
                (key != 'Agreement')
            ) %}

                <tr>
                    <th>{{key}}</th>
                    <td>{{data[key]}}</td>

                    {% if(edits != {}) %}
                        {% if(key in edits) %}
                            <td>{{edits[key]}}</td>
                        {% else %} <td></td>
                        {% endif %}
                    {% endif %}

                </tr>

            {% endif %}
        
        {% endfor %}
    </table> -->

    {% if (data['Status'] in ['Payment Required', 'Delegation Required', 'Application Submitted', 'Engineering Review']) %}

        {% if (current_user.roles == []) and current_user.is_authenticated %}
            <div class="row my-5 justify-content-md-center">
                <div class="col-md-6">
                    <a class="btn btn-dark w-100" id="editDetails" href="{{'/edit/' + data['ID'] }}" role="button">
                        <!-- <span class="spinner-border spinner-border-sm me-2" id="editSpinner" role="status" aria-hidden="true" hidden></span> -->
                        Edit Application Details
                    </a>
                </div>
            </div>
        {% endif %}
        
        {% if(edits != {}) %}
        {% if('engineer' in current_user.roles) %}
            <!-- Accept changes modal -->
            <div class="modal fade" id="acceptEditsModal" tabindex="-1" aria-labelledby="acceptEditsModalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="acceptEditsModalTitle" >Accept Application Changes</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">Are you sure you want to approve the changes?</div>
                        <div class="modal-footer">
                            <form action="{{'/reviewEdits/' + data['ID'] + '/accept' }}">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancel">Cancel</button>
                                <button type="submit" class="btn btn-success" id="acceptEdits">
                                    <span class="spinner-border spinner-border-sm me-2" id="acceptEditsSpinner" role="status" aria-hidden="true" hidden></span>
                                    Approve
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Reject changes modal -->
            <div class="modal fade" id="rejectEditsModal" tabindex="-1" aria-labelledby="rejectEditsModalTitle" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="rejectEditsModalTitle" >Reject Application Changes</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">Are you sure you want to reject the changes?</div>
                        <div class="modal-footer">
                            <form action="{{'/reviewEdits/' + data['ID'] + '/reject' }}">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancel">Cancel</button>
                                <button type="submit" class="btn btn-danger" id="rejectEdits">
                                    <span class="spinner-border spinner-border-sm me-2" id="rejectEditsSpinner" role="status" aria-hidden="true" hidden></span>
                                    Reject
                                </button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Script to display accept/reject spinners -->
            <script type="text/javascript">
                const acceptSpinner = document.getElementById("acceptEditsSpinner")
                const acceptButton = document.getElementById("acceptEdits")
                acceptButton.addEventListener("click", (evt) => {
                    // evt.preventDefault()
                    // evt.stopPropagation()
                    if (acceptSpinner.hasAttribute("hidden")) {
                        acceptSpinner.removeAttribute("hidden")
                    }
                })
                const rejectSpinner = document.getElementById("rejectEditsSpinner")
                const rejectButton = document.getElementById("rejectEdits")
                rejectButton.addEventListener("click", (evt) => {
                    // evt.preventDefault()
                    // evt.stopPropagation()
                    if (rejectSpinner.hasAttribute("hidden")) {
                        rejectSpinner.removeAttribute("hidden")
                    }
                })
            </script>

            <!-- Accept/reject buttons -->
            <div class="row my-5 gap-3 gap-sm-0 justify-content-center">
                <div class="col-8 col-sm-6 col-md-5 col-lg-4">
                    <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#rejectEditsModal">Reject Application Changes</button>
                </div>
                <div class="col-8 col-sm-6 col-md-5 col-lg-4">
                    <button type="button" class="btn btn-success w-100" data-bs-toggle="modal" data-bs-target="#acceptEditsModal">Accept Application Changes</button>
                </div>
            </div>
        {% endif %}
        {% endif %}

    {% endif %}

    <hr class="my-4">

    <h2 class="my-4">Attachments</h2>
    
    <!-- <div id='attachments'>

        {% for doc in appAttachments %}
        
            <hr>
            
            <H3>{{doc}}</H3>
            
            <table>
                {% for file in files.get(doc, None) %}
                    <tr>
                    <th>{{file}}</th>
                    <th style='font-weight: normal'>
                        <a href="{{'/download/' + data['ID']+'/'+doc+'/'+file}}">Download</a>
                    </th>
                    </tr>
                {% endfor %}
          </table>

          <form action="{{'/upload/' + data['ID'] + '/' + doc}}" method="post" enctype="multipart/form-data">
              <input type="file" name="file">
              <input type="submit" value="{{'Upload ' + doc}}">
          </form>

        {% endfor %}

        <hr>

    </div> -->

    <!-- Bootstrap attachments -->
    <div class="row g-4">
    {% for doc in appAttachments %}
        <div class="col-12">
            <div class="card text-center">
                <div class="card-header py-3">
                    <h3 class="card-title mb-0">{{doc}}</h3>
                </div>
                <ul class="list-group list-group-flush">
                    {% if files.get(doc, None)|length < 1 %}
                    <li class="list-group-item">
                        <h5 class="my-4">No files to display</h5>
                    </li>
                    {% endif %}
                    {% for file in files.get(doc, None)%}
                    <li class="list-group-item py-1">
                        <div class="d-flex justify-content-between align-items-center">
                            <div class="">{{file}}</div>
                            <!-- <div class=""> -->
                                <div class="btn-group btn-group-sm" role="group" aria-label="view or download file">
                                    <a class="btn btn-outline-dark" role="button" href="{{'/download/' + data['ID']+'/'+doc+'/'+file}}">View</a>
                                    <a class="btn btn-outline-dark" role="button" href="{{'/download/' + data['ID']+'/'+doc+'/'+file}}" download>Download</a>
                                </div>
                            <!-- </div> -->
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                <div class="card-footer py-3">
                    <button type="button" class="btn btn-dark" data-bs-toggle="modal" data-bs-target="#{{doc.replace(' ', '')}}Modal">Upload {{doc}}</button>
                </div>    
            </div>
        </div>

        <div class="modal fade" id="{{doc.replace(' ', '')}}Modal" tabindex="-1" aria-labelledby="{{doc.replace(' ', '')}}ModalTitle" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered">
                <div class="modal-content">
                    <form action="{{'/upload/' + data['ID'] + '/' + doc}}" method="post" enctype="multipart/form-data">
                        <div class="modal-header">
                            <h5 class="modal-title" id="{{doc.replace(' ', '')}}ModalTitle">Upload New {{doc}}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" arial-label="Close"></button>
                        </div>
                        <div class="modal-body py-5 text-center">
                            <!-- <label for="{{doc.replace(' ', '')}}File" class="form-label"></label>
                            <input class="form-control" type="file" id="{{doc.replace(' ', '')}}File"> -->
                            <div class="mb-2">
                                <label class="btn btn-dark" for="{{doc.replace(' ', '')}}FileUpload">
                                    <input type="file" class="form-control-file d-none" id="{{doc.replace(' ', '')}}FileUpload" name="file">
                                    Choose File
                                </label>
                            </div>
                            <div class="" id="{{doc.replace(' ', '')}}FileInfo">No file chosen</div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-outline-dark" data-bs-dismiss="modal" id="cancel{{doc.replace(' ', '')}}">Cancel</button>
                            <button type="submit" class="btn btn-dark" id="{{doc.replace(' ', '')}}FileSubmit">
                                <span class="spinner-border spinner-border-sm me-2" id="{{doc.replace(' ', '')}}FileSpinner" role="status" aria-hidden="true" hidden></span>
                                Upload
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <script type="text/javascript">
            {
                const docFileSubmit = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileSubmit")
                const docFileSpinner = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileSpinner")
                docFileSubmit.addEventListener("click", (evt) => {
                    // evt.preventDefault()
                    // evt.stopPropagation()
                    if (docFileSpinner.hasAttribute("hidden")) {
                        docFileSpinner.removeAttribute("hidden")
                    }
                })
                const docFileUpload = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileUpload")
                const docFileInfo = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileInfo")
                docFileUpload.addEventListener("change", () => {
                    docFileInfo.innerHTML = docFileUpload.files.length ? docFileUpload.files[0].name : "No file chosen"
                })
            }
        </script>

        <!-- <h5>{{doc}}</h5> -->

        <!-- TODO: Bootstrap table -->
        <!-- <table>
            {% for file in files.get(doc, None) %}
                <tr>
                <th>{{file}}</th>
                <th style='font-weight: normal'>
                    <a href='{{"/download/" + data['ID']+'/'+doc+'/'+file}}'>Download</a>
                </th>
                </tr>
            {% endfor %}
        </table> -->

        <!-- <form action="{{'/upload/' + data['ID'] + '/' + doc}}" method="post" enctype="multipart/form-data">
            <div class="form-group">
                <label class="btn btn-dark mb-0" for="{{doc.replace(' ', '')}}FileUpload">
                    <input type="file" class="form-control-file d-none" id="{{doc.replace(' ', '')}}FileUpload" name="file">
                    Choose File
                </label>
                <span class="label label-info" id="{{doc.replace(' ', '')}}FileInfo">No file chosen</span>
                <label for="{{doc.replace(' ', '')}}FileSubmit" class="sr-only">Upload {{doc}}</label>
                <input type="submit" class="btn btn-dark" id="{{doc.replace(' ', '')}}FileSubmit" value="{{'Upload ' + doc}}">
            </div>
        </form> -->
        
        <!-- <script type="text/javascript">
            {
                let docFileUpload = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileUpload")
                let docFileInfo = document.getElementById("{{doc}}".replace(/\s+/g, "") + "FileInfo")
                docFileUpload.addEventListener("change", () => {
                    docFileInfo.innerHTML = docFileUpload.files.length ? docFileUpload.files[0].name : "No file chosen"
                })
            }
        </script> -->
    {% endfor %}
    </div>

    <hr class='my-4'>
    
    <!-- TODO: Bootstrap -->
    {% if (data.get('Screen Results','') != '') %}
    <h3><hr><h3>
    <H3>Automated Screening Results</H3>
    <table>
        {% for key in data['Screen Results'] %}
        {% if (key != 'passedAll') %}
            <tr>
                <th>{{key}}</th>
                <th style='font-weight: normal'>{{data['Screen Results'][key]}}</th>
            </tr>
        {% endif %}
        {% endfor %}
    </table>
    {% endif %}


    <h2 class="my-4">Application Status</h2>

    <!-- Bootstrap update buttons -->
    {% if updates|length > 0 %}
    <div class="row mb-5 gap-4 justify-content-center">
        {% for update in updates %}
        <!-- <div class="row my-4"> -->
            <div class="col-12 col-md-8 col-lg-7">
                <form action="{{'/update-status/' + data['ID'] + '/' + update}}">
                    <button type="submit" class="btn btn-dark w-100" value="{{'Update status to ' + update}}">
                        {{'Update status to '}}
                        <span class="fst-italic fw-bold">{{update}}</span>
                    </button>
                </form>
            </div>
        <!-- </div> -->
        {% endfor %}
    </div>
    {% endif %}

    <!-- <div class="my-5"></div> -->

{% endblock %}

{% block member %}
<div class="row mb-5 gap-4 justify-content-center">
    
    <!-- Bootstrap payment button -->
    {% if data['Status'] == 'Payment Required' %}
    <div class="row justify-content-center alert alert-warning text-center mb-0 px-0">
        <h4 class="mb-3 alert-heading">Payment Required</h4>
        <div class="col-12 col-md-6">
            <a class="btn btn-warning w-100" href="{{'/payment/' + data['ID']}}" role="button">
                Pay Application Fee
            </a>
        </div>
    </div>
    {% endif %}

    <!-- Bootstrap withdraw button -->
    <div class="col-12 col-md-6">
        <!-- <h5>Click below to Withdraw Interconnection Application</h5> -->
        <button type="button" class="btn btn-danger w-100" data-bs-toggle="modal" data-bs-target="#withdrawModal">Withdraw Application</button>    
    </div>
    
    <!-- Bootstrap withdraw modal -->
    <div class="modal fade" id="withdrawModal" tabindex="-1" aria-labelledby="withdrawModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="withdrawModalTitle" >Withdraw Interconnection Application</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">Are you sure you want to withdraw the application?</div>
                <div class="modal-footer">
                    <form action="{{'/update-status/' + data['ID'] + '/Withdrawn'}}">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="cancel">Cancel</button>
                        <button type="submit" class="btn btn-danger" id="withdraw">
                            <span class="spinner-border spinner-border-sm me-2" id="withdrawSpinner" role="status" aria-hidden="true" hidden></span>
                            Withdraw
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Script to display withdraw button spinner -->
    <script type="text/javascript">
        const withdrawSpinner = document.getElementById("withdrawSpinner")
        const withdrawButton = document.getElementById("withdraw")
        withdrawButton.addEventListener("click", () => {
            if (withdrawSpinner.hasAttribute("hidden")) {
                withdrawSpinner.removeAttribute("hidden")
            }
            withdrawButton.childNodes[2].textContent = "Withdrawing..."
        })
    </script>

    <!-- <hr> -->

</div>
{% endblock %}

{% block ms %}
{% endblock %}

{% block engineer %}
    {% if eng_data|length != 0 %}
    
    <script src="/static/sorttable.js"></script>

    <H2>Interconnection Details</H2>

    <!-- Tables -->
    <p class="reportTitle">Maximum and Minimum Voltages</p>
    <table id="minMaxVolts">
        <tr>
            <th rowspan="2">DER Status</th>
            <th rowspan="2">Load Condition</th>
            <th colspan="2">Max Voltage</th>
            <th colspan="2">Min Voltage</th>
        </tr>
        <tr>
            <th>V</th>
            <th>Location</th>
            <th>V</th>
            <th>Location</th>
        </tr>
        <tr>
            <td>On</td>
            <td>Peak</td>
            <td id="derOnMaxVoltValPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOnMaxVoltValPeak").innerHTML = sampleData['maxVoltsPeakDerOn'][1]
            </script>
            <td id="derOnMaxVoltLocPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOnMaxVoltLocPeak").innerHTML = sampleData['maxVoltsPeakDerOn'][0]
            </script>
            <td id="derOnMinVoltValPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOnMinVoltValPeak").innerHTML = sampleData['minVoltsPeakDerOn'][1]
            </script>
            <td id="derOnMinVoltLocPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOnMinVoltLocPeak").innerHTML = sampleData['minVoltsPeakDerOn'][0]
            </script>
        </tr>
        <tr>
            <td>On</td>
            <td>Min</td>
            <td id="derOnMaxVoltValMin"></td>
            <script type="text/javascript">
                document.getElementById("derOnMaxVoltValMin").innerHTML = sampleData['maxVoltsMinDerOn'][1]
            </script>
            <td id="derOnMaxVoltLocMin"></td>
            <script type="text/javascript">
                document.getElementById("derOnMaxVoltLocMin").innerHTML = sampleData['maxVoltsMinDerOn'][0]
            </script>
            <td id="derOnMinVoltValMin"></td>
            <script type="text/javascript">
                document.getElementById("derOnMinVoltValMin").innerHTML = sampleData['minVoltsMinDerOn'][1]
            </script>
            <td id="derOnMinVoltLocMin"></td>
            <script type="text/javascript">
                document.getElementById("derOnMinVoltLocMin").innerHTML = sampleData['minVoltsMinDerOn'][0]
            </script>
        </tr>
        <tr>
            <td>Off</td>
            <td>Peak</td>
            <td id="derOffMaxVoltValPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOffMaxVoltValPeak").innerHTML = sampleData['maxVoltsPeakDerOff'][1]
            </script>
            <td id="derOffMaxVoltLocPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOffMaxVoltLocPeak").innerHTML = sampleData['maxVoltsPeakDerOff'][0]
            </script>
            <td id="derOffMinVoltValPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOffMinVoltValPeak").innerHTML = sampleData['minVoltsPeakDerOff'][1]
            </script>
            <td id="derOffMinVoltLocPeak"></td>
            <script type="text/javascript">
                document.getElementById("derOffMinVoltLocPeak").innerHTML = sampleData['minVoltsPeakDerOff'][0]
            </script>
        </tr>
        <tr>
            <td>Off</td>
            <td>Min</td>
            <td id="derOffMaxVoltValMin"></td>
            <script type="text/javascript">
                document.getElementById("derOffMaxVoltValMin").innerHTML = sampleData['maxVoltsMinDerOff'][1]
            </script>
            <td id="derOffMaxVoltLocMin"></td>
            <script type="text/javascript">
                document.getElementById("derOffMaxVoltLocMin").innerHTML = sampleData['maxVoltsMinDerOff'][0]
            </script>
            <td id="derOffMinVoltValMin"></td>
            <script type="text/javascript">
                document.getElementById("derOffMinVoltValMin").innerHTML = sampleData['minVoltsMinDerOff'][1]
            </script>
            <td id="derOffMinVoltLocMin"></td>
            <script type="text/javascript">
                document.getElementById("derOffMinVoltLocMin").innerHTML = sampleData['minVoltsMinDerOff'][0]
            </script>
        </tr>
    </table>

    <p class="reportTitle">Maximum Voltage Flicker when DER is turned off</p>
    <table id="maxVoltFlicker">
        <tr>
            <th>Load Condition</th>
            <th>&percnt;</th>
            <th>Location</th>
        </tr>
        <tr>
            <td>Peak</td>
            <td id="flickerValPeak"></td>
            <script type="text/javascript">
                document.getElementById("flickerValPeak").innerHTML = sampleData['maxFlickerPeak'][1].toFixed(2)
            </script>
            <td id="flickerLocPeak"></td>
            <script type="text/javascript">
                document.getElementById("flickerLocPeak").innerHTML = sampleData['maxFlickerPeak'][0]
            </script>
        </tr>
        <tr>
            <td>Min</td>
            <td id="flickerValMin"></td>
            <script type="text/javascript">
                document.getElementById("flickerValMin").innerHTML = sampleData['maxFlickerMin'][1].toFixed(2)
            </script>
            <td id="flickerLocMin"></td>
            <script type="text/javascript">
                document.getElementById("flickerLocMin").innerHTML = sampleData['maxFlickerMin'][0]
            </script>
        </tr>
    </table>

    <p class="reportTitle">Voltage Values</p>
    <div class="tableContainer">
        <table class="sortable" id="voltageViolations">
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Nominal Voltage</th>
                    <th>Voltage Value</th>
                    <th>&percnt; Change</th>
                    <th>DER Status</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var voltageViolations = sampleData['voltageViolations'];
            var content = ''; var totalContent = '';

            for (var i = 0; i < voltageViolations.length; i++) {
                content = '<td>' + voltageViolations[i][0] + '</td><td>' +
                    voltageViolations[i][1].toFixed(2) + '</td><td>' +
                    voltageViolations[i][2].toFixed(2) + '</td><td>' +
                    voltageViolations[i][3].toFixed(2) + '&percnt;</td><td>' +
                    voltageViolations[i][4] + '</td>';
                if (voltageViolations[i][5] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content
            }
            document.getElementById("voltageViolations").innerHTML += totalContent;
        </script>

        <span style="color: red">Voltage values non-compliant with ANSI C84.1 Range A Service voltages are displayed in red</span>
    </div>

    <p class="reportTitle">Voltage Flicker when DER is turned off</p>
    <div class="tableContainer">
        <table class="sortable" id="flickerViolations">
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Voltage Flicker</th>
                    <th>Load Condition</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var flickerViolations = sampleData['flickerViolations'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < flickerViolations.length; i++) {
                content = '<td>' + flickerViolations[i][0] + '</td><td>' + flickerViolations[i][1].toFixed(2) + '&percnt;</td><td>' + flickerViolations[i][2] + '</td>';
                if (flickerViolations[i][3] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content
            }
            document.getElementById("flickerViolations").innerHTML += totalContent;
        </script>
        <span style="color: red">Voltage flicker values greater or equal to the input flicker threshold are displayed in
            red
        </span>
    </div>

    <p class="reportTitle">Line Loading</p>
    <div class="tableContainer">
        <table class="sortable" id="thermalViolations">
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Line Load (&percnt; rating)</th>
                    <th>DER Status</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var thermalViolations = sampleData['thermalViolations'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < thermalViolations.length; i++) {
                content = '<td>' + thermalViolations[i][0] + '</td><td>' + thermalViolations[i][1].toFixed(2) + '&percnt;</td><td>' + thermalViolations[i][2] + '</td>';
                if (thermalViolations[i][3] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content
            }
            document.getElementById("thermalViolations").innerHTML += totalContent;
        </script>
        <span style="color: red">Line loading values greater or equal to the input threshold are displayed in red</span>
    </div>

    <p class="reportTitle">Regulator Power Flow</p>
    <div class="tableContainer">
        <table class="sortable" id="reversePowerFlow">
            <thead>
                <tr>
                    <th>Location</th>
                    <th>Power</th>
                    <th>DER Status</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var reversePowerFlow = sampleData['reversePowerFlow'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < reversePowerFlow.length; i++) {
                content = '<td>' + reversePowerFlow[i][0] + '</td><td>' +
                    reversePowerFlow[i][1].toFixed(2) + '</td><td>' +
                    reversePowerFlow[i][2] + '</td>';
                if (reversePowerFlow[i][3] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content
            }
            document.getElementById("reversePowerFlow").innerHTML += totalContent;
        </script>
        <span style="color: red">Reverse power flow violations displayed in red</span>
    </div>

    <p class="reportTitle">Tap Changes</p>
    <div class="tableContainer">
        <table class="sortable" id="tapChanges">
            <thead>
                <tr>
                    <th>Load Condition</th>
                    <th>Location</th>
                    <th>Tap Position DER On</th>
                    <th>Tap Position DER Off</th>
                    <th>Difference</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var tapViolations = sampleData['tapViolations'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < tapViolations.length; i++) {
                content = '<td>' + tapViolations[i][0] + '</td><td>' + tapViolations[i][1] +
                    '</td><td>' + tapViolations[i][2] + '</td><td>' + tapViolations[i][3] +
                    '</td><td>' + tapViolations[i][4] + '</td>';
                if (tapViolations[i][5] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content;
            }
            document.getElementById("tapChanges").innerHTML += totalContent;
        </script>
        <span style="color: red">Tap change differences greater or equal to the input max tap change difference are displayed
            in red</span>
    </div>

    <p class="reportTitle">Short Circuit Analysis</p>
    <div class="tableContainer">

        <p>DER Breaker Fault Current</p>
        <table class="sortable" id="faultBreaker">
            <thead>
                <tr>
                    <th>Load Condition</th>
                    <th>Fault Type</th>
                    <th>DER On</th>
                    <th>DER Off</th>
                    <th>Difference</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var faultBreaker = sampleData['faultBreaker'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < faultBreaker.length; i++) {
                content = '<td>' + faultBreaker[i][0] + '</td><td>' +
                    faultBreaker[i][1] + '</td><td>' + faultBreaker[i][2].toFixed(2) +
                    '</td><td>' + faultBreaker[i][3].toFixed(2) + '</td><td>' +
                    faultBreaker[i][4].toFixed(2) + '</td>';
                content = '<tr>' + content + '</tr>';
                totalContent += content;
            }
            document.getElementById("faultBreaker").innerHTML += totalContent;
        </script>
    </div>
    <div class="tableContainer">
        <p>DER Transformer Fault Current</p>
        <table class="sortable" id="faultStepUp">
            <thead>
                <tr>
                    <th>Load Condition</th>
                    <th>Fault Type</th>
                    <th>DER On</th>
                    <th>DER Off</th>
                    <th>Difference</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var faultStepUp = sampleData['faultStepUp'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < faultStepUp.length; i++) {
                content = '<td>' + faultStepUp[i][0] + '</td><td>' +
                    faultStepUp[i][1] + '</td><td>' + faultStepUp[i][2].toFixed(2) +
                    '</td><td>' + faultStepUp[i][3].toFixed(2) + '</td><td>' +
                    faultStepUp[i][4].toFixed(2) + '</td>';
                content = '<tr>' + content + '</tr>';
                totalContent += content;
            }
            document.getElementById("faultStepUp").innerHTML += totalContent;
        </script>
    </div>

    <p class="reportTitle">Fault Current Violations with DER On</p>
    <div class="tableContainer">
        <table class="sortable" id="faultCurrentViolations">
            <thead>
                <tr>
                    <th>Load Condition</th>
                    <th>Fault Location</th>
                    <th>Fault Type</th>
                    <th>Measurement Location</th>
                    <th>Pre-fault Current</th>
                    <th>Post-fault Current</th>
                    <th>&percnt; Change</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var faultCurrentViolations = sampleData['faultCurrentViolations'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < faultCurrentViolations.length; i++) {
                content = '<td>' + faultCurrentViolations[i][0] + '</td><td>' +
                    faultCurrentViolations[i][1] + '</td><td>' +
                    faultCurrentViolations[i][2] + '</td><td>' +
                    faultCurrentViolations[i][3] + '</td><td>' +
                    faultCurrentViolations[i][4].toFixed(2) + '</td><td>' +
                    faultCurrentViolations[i][5].toFixed(2) + '</td><td>' +
                    faultCurrentViolations[i][6].toFixed(2) + '</td>';
                if (faultCurrentViolations[i][7] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content;
            }
            document.getElementById("faultCurrentViolations").innerHTML += totalContent;
        </script>
        <span style="color: red">Fault current differences as a percent of the pre-fault current that are greater than or
            equal to the input threshold are displayed in red</span>
    </div>

    <p class="reportTitle">Effective Grounding Screening</p>
    <div class="tableContainer">
        <p>Line to Ground Fault at the POI</p>
        <table class="sortable" id="faultPOIVolts">
            <thead>
                <tr>
                    <th>DER Status</th>
                    <th>Fault Location</th>
                    <th>Fault Type</th>
                    <th>Pre-fault Voltage</th>
                    <th>Post-fault Voltage</th>
                    <th>Post-fault Percent</th>
                </tr>
            </thead>
        </table>
        <script type="text/javascript">
            var faultPOIVolts = sampleData['faultPOIVolts'];
            var content = ''; var totalContent = '';
            for (var i = 0; i < faultPOIVolts.length; i++) {
                content = '<td>' + faultPOIVolts[i][0] + '</td><td>' +
                    faultPOIVolts[i][1] + '</td><td>' +
                    faultPOIVolts[i][2] + '</td><td>' +
                    faultPOIVolts[i][3].toFixed(2) + '</td><td>' +
                    faultPOIVolts[i][4].toFixed(2) + '</td><td>' +
                    faultPOIVolts[i][5].toFixed(2) + '</td>';
                if (faultPOIVolts[i][6] == true)
                    content = '<tr style=\"color: red\">' + content + '</tr>';
                else content = '<tr>' + content + '</tr>';
                totalContent += content;
            }
            document.getElementById("faultPOIVolts").innerHTML += totalContent;
        </script>
        <span style="color: red">Post-fault voltage values as a percent of the pre-fault voltage that are greater than or
            equal to the input threshold are displayed in red</span>
    </div>

    </div>

    {% endif %}   
{% endblock %}

<!-- Bootstrap notes block -->
{% macro notes() %}
<div>
    <h2 class="my-4">Notes Log</h2>
    <div class="my-3">
        <textarea class="form-control" id="notesDisplay" rows="10" disabled="True" readonly placeholder="There are no notes for this application at the current time." aria-label="notes log">{{data['Notes']}}</textarea>
    </div>
    <form id="notes" action="{{'/save-notes/' + data['ID']}}" method="post">
        <div class="my-4">
            <textarea class="form-control" id="noteInput" name="notesText" rows="3" placeholder="Enter note text here and click save to add a note." aria-label="new note"></textarea>
        </div>
        <div class="row my-4 justify-content-md-center">
            <div class="col-md-5 col-lg-4">
                <button type="submit" class="btn btn-dark w-100" name="save" id="notesSave">Save Note</button>
            </div>
        </div>
    </form>
    <hr class="my-4">
</div>
{% endmacro %}