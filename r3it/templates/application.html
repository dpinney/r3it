{% extends "base.html" %}

{% block content %}

    <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
    <script src="https://js.stripe.com/v3/"></script>
    
    <script type="text/javascript">

        // May require cleanup after form revamp
        function showCorrectFormParts(radio) {

            appType = radio.value;
            contractor = document.getElementById("contractor");
            electrician = document.getElementById("electrician");

            switch (appType){
                case 'Contractor only':
                    contractor.style.display = 'inline';
                    electrician.style.display = 'none';
                    setFormPartDisabledVal(contractor,false)
                    setFormPartDisabledVal(electrician,true)
                    break;
                case 'Contractor and Electrician':
                    contractor.style.display = 'inline';
                    electrician.style.display = 'inline';
                    setFormPartDisabledVal(contractor,false)
                    setFormPartDisabledVal(electrician,false)
                    break;
                case 'Self-install':
                    contractor.style.display = 'none';
                    electrician.style.display = 'none';
                    setFormPartDisabledVal(contractor,true)
                    setFormPartDisabledVal(electrician,true)
                    break;
            }

            function setFormPartDisabledVal(container,val) {

                childElements = container.children
                for (var i = 0, l = childElements.length; i < l; ++i) {
                    childElements[i].disabled = val;
                }
            }

        }

        function ensureMemberIsNotContractor(lastChangedID) {
            
            console.log(lastChangedID)

            member = document.getElementById("emailMember").value;
            contractor = document.getElementById("emailContact").value;
            if (member == contractor) {
                
                alert("Member and contractor must be separate entities. If the member is performing the install, please selct 'Self-install' as the installation type")
                
                differentBlankVal = '';
                if (member == '') {differentBlankVal = ' ';}
                document.getElementById(lastChangedID).value = differentBlankVal;
            }

        }

    </script>

    <!-- Bootstrap application form -->
    <h1 class="mb-4">New Interconnection Application</h1>
    <form id="application" action="{{formAction}}" method='post' onsubmit="submitForm()">

        <!-- Member Block -->
        <div id="member" class="mb-5">
            <h3 class="mb-3">Member Contact Information</h3>

            <div class="row mb-3">
                <div class="col-6">
                    <label for="nameMember" class="form-label">Full Name</label>
                    <input type="text" class="form-control" id="nameMember" name="Name (Member)" value="{{default['Name (Member)']}}" placeholder="">
                </div>
            </div>

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Mailing Address</legend>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="addressMember" name="Address (Member)" value="{{default['Address (Member)']}}" placeholder="Street Address" aria-label="street address">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="address2Member" name="Address 2 (Member)" value="{{default['Address 2 (Member)']}}" placeholder="Address Line 2" aria-label="address line 2">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-3">
                        <input type="text" class="form-control" id="cityMember" name="City (Member)" value="{{default['City (Member)']}}" placeholder="City" aria-label="city">
                    </div>
                    <div class="col-2">
                        <select class="form-select" id="stateMember" name="State (Member)" aria-label="member state">
                            <option hidden selected disabled>--- State ---</option>
                            {% for state in states %}
                                <option value="{{state}}" {% if (state == default['State (Member)']) %} selected="true" {% endif %}>{{state}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-3">
                        <input type="text" class="form-control" id="zipMember" name="Zip (Member)" value="{{default['Zip (Member)']}}" placeholder="Postal / Zip Code" aria-label="postal or zip code">
                    </div>
                </div>
            </fieldset>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="primaryPhoneMember" class="form-label">Primary Phone</label>
                    <input type="tel" class="form-control" id="primaryPhoneMember" name="Phone (Primary, Member)" value="{{default['Phone (Primary, Member)']}}">
                </div>
                <div class="col-4">
                    <label for="secondaryPhoneMember" class="form-label">Secondary Phone</label>
                    <input type="tel" class="form-control" id="secondaryPhoneMember" name="Phone (Secondary, Member)" value="{{default['Phone (Secondary, Member)']}}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="emailMember" class="form-label">Email</label>
                    <input type="email" class="form-control" id="emailMember" name="Email (Member)" value="{{default['Email (Member)']}}" onchange="ensureMemberIsNotContractor(this.id)">
                </div>
                <div class="col-4">
                    <label for="faxMember" class="form-label">Fax</label>
                    <input type="tel" class="form-control" id="faxMember" name="Fax (Member)" value="{{default['Fax (Member)']}}">
                </div>
            </div>

            <div class="form-check mb-3 ms-1 pt-2">
                <input type="checkbox" class="form-check-input" id="useAltContact">
                <label for="useAltContact" class="form-check-label">Use Alternate Contact</label>
            </div>
        </div>

        <!-- Alternate Contact Block -->
        <div id="altContact" class="mb-5" hidden>
            <h3 class="mb-3">Alternate Contact Information</h3>

            <div class="row mb-3">
                <div class="col-6">
                    <label for="nameAltContact" class="form-label">Contact Name</label>
                    <input type="text" class="form-control" id="nameAltContact" name="Name (Alt Contact)" value="{{default['Name (Alt Contact)']}}">
                </div>
            </div>

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Contact Address</legend>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="addressAltContact" name="Address (Alt Contact)" value="{{default['Address (Alt Contact)']}}" placeholder="Street Address" aria-label="street address">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="address2AltContact" name="Address 2 (Alt Contact)" value="{{default['Address 2 (Alt Contact)']}}" placeholder="Address Line 2" aria-label="address line 2">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-3">
                        <input type="text" class="form-control" id="cityAltContact" name="City (Alt Contact)" value="{{default['City (Alt Contact)']}}" placeholder="City" aria-label="city">
                    </div>
                    <div class="col-2">
                        <select class="form-select" id="stateAltContact" name="State (Alt Contact)" aria-label="alt contact state">
                            <option hidden selected disabled>--- State ---</option>
                            {% for state in states %}
                                <option value="{{state}}" {% if (state == default['State (Alt Contact)']) %} selected="true" {% endif %}>{{state}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-3">
                        <input type="text" class="form-control" id="zipAltContact" name="Zip (Alt Contact)" value="{{default['Zip (Alt Contact)']}}" placeholder="Postal / Zip Code" aria-label="postal or zip code">
                    </div>
                </div>
            </fieldset>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="primaryPhoneAltContact" class="form-label">Primary Phone</label>
                    <input type="tel" class="form-control" id="primaryPhoneAltContact" name="Phone (Primary, Alt Contact)" value="{{default['Phone (Primary, Alt Contact)']}}">
                </div>
                <div class="col-4">
                    <label for="secondaryPhoneAltContact" class="form-label">Secondary Phone</label>
                    <input type="tel" class="form-control" id="secondaryPhoneAltContact" name="Phone (Secondary, Alt Contact)" value="{{default['Phone (Secondary, Alt Contact)']}}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="emailAltContact" class="form-label">Email</label>
                    <input type="email" class="form-control" id="emailAltContact" name="Email (Alt Contact)" value="{{default['Email (Alt Contact)']}}" onchange="ensureMemberIsNotContractor(this.id)">
                </div>
                <div class="col-4">
                    <label for="faxAltContact" class="form-label">Fax</label>
                    <input type="tel" class="form-control" id="faxAltContact" name="Fax (Alt Contact)" value="{{default['Fax (Alt Contact)']}}">
                </div>
            </div>
        </div>

        <!-- Script to show/hide alt contact based on checkbox -->
        <script type="text/javascript">
            const useAltContact = document.getElementById("useAltContact")
            const altContact = document.getElementById("altContact")
            useAltContact.addEventListener("click", () => {
                if (altContact.hasAttribute("hidden")) {
                    altContact.removeAttribute("hidden")
                } else {
                    altContact.setAttribute("hidden", "true")
                }
            })
        </script>

        <!-- Equipment Contractor Block -->
        <div id="contractor" class="mb-5">
            <h3 class="mb-3">Equipment Contractor Information</h3>

            <div class="row mb-3" id="contractorNameBlock">
                <div class="col-4">
                    <label for="nameContractor" class="form-label">Equipment Contractor Name</label>
                    <input type="text" class="form-control" id="nameContractor" name="Name (Contractor)" value="{{default['Name (Contractor)']}}">
                </div>

                <div class="form-check col-4 ms-3 mt-4 pt-3">
                    <input type="checkbox" class="form-check-input" id="contractorIsElectrician">
                    <label for="contractorIsElectrician" class="form-check-label">Acting as Electric Contractor</label>
                </div>
            </div>

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Equipment Contractor Address</legend>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="addressContractor" name="Address (Contractor)" value="{{default['Address (Contractor)']}}" placeholder="Street Address" aria-label="street address">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="address2Contractor" name="Address 2 (Contractor)" value="{{default['Address 2 (Contractor)']}}" placeholder="Address Line 2" aria-label="address line 2">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-3">
                        <input type="text" class="form-control" id="cityContractor" name="City (Contractor)" value="{{default['City (Contractor)']}}" placeholder="City" aria-label="city">
                    </div>
                    <div class="col-2">
                        <select class="form-select" id="stateContractor" name="State (Contractor)" aria-label="contractor state">
                            <option hidden selected disabled>--- State ---</option>
                            {% for state in states %}
                                <option value="{{state}}" {% if (state == default['State (Contractor)']) %} selected="true" {% endif %}>{{state}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-3">
                        <input type="text" class="form-control" id="zipContractor" name="Zip (Contractor)" value="{{default['Zip (Contractor)']}}" placeholder="Postal / Zip Code" aria-label="postal or zip code">
                    </div>
                </div>
            </fieldset>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="primaryPhoneContractor" class="form-label">Equipment Contractor Primary Phone</label>
                    <input type="tel" class="form-control" id="primaryPhoneContractor" name="Phone (Primary, Contractor)" value="{{default['Phone (Primary, Contractor)']}}">
                </div>
                <div class="col-4">
                    <label for="secondaryPhoneContractor" class="form-label">Equipment Contractor Secondary Phone</label>
                    <input type="tel" class="form-control" id="secondaryPhoneContractor" name="Phone (Secondary, Contractor)" value="{{default['Phone (Secondary, Contractor)']}}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="emailContractor" class="form-label">Equipment Contractor Email</label>
                    <input type="email" class="form-control" id="emailContractor" name="Email (Contractor)" value="{{default['Email (Contractor)']}}" onchange="ensureMemberIsNotContractor(this.id)">
                </div>
                <div class="col-4">
                    <label for="faxContractor" class="form-label">Equipment Contractor Fax</label>
                    <input type="tel" class="form-control" id="faxContractor" name="Fax (Contractor)" value="{{default['Fax (Contractor)']}}">
                </div>
            </div>

            <div class="row mb-3 mt-4">
                <div class="alert alert-info col-8 mb-0" role="alert">
                    All interconnected Facilities must be either installed or inspected by a certified distributed generation installer in accordance with [83 Ill. Adm. Code 468].  Click <a href="https://www.icc.illinois.gov/Electricity/authorities/DistributedGenerationCertification.aspx" class="alert-link">HERE</a> for additional information.
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="docketNumber" class="form-label">Installer Certificate Docket Number</label>
                    <input type="text" class="form-control" id="docketNumber" name="Docket Number" value="{{default['Docket Number']}}">
                </div>
            </div>
        </div>

        <!-- Electrical Contractor Block -->
        <div id="electrician" class="mb-5">
            <h3 class="mb-3">Electrical Contractor Information</h3>

            <div class="row mb-3" id="electricianNameBlock">
                <div class="col-4">
                    <label for="nameElectrician" class="form-label">Electrical Contractor Name</label>
                    <input type="text" class="form-control" id="nameElectrician" name="Name (Electrician)" value="{{default['Name (Electrician)']}}">
                </div>
            </div>

            <div class="row mb-3" id="licenseBlock">
                <div class="col-4">
                    <label for="licenseElectrician" class="form-label">Electrical Contractor License</label>
                    <input type="text" class="form-control" id="licenseElectrician" name="License (Electrician)" value="{{default['License (Electrician)']}}">
                </div>

                <div class="form-check col-4 ms-3 mt-4 pt-3">
                    <input type="checkbox" class="form-check-input" id="activeLicense">
                    <label for="activeLicense" class="form-check-label">Active License</label>
                </div>
            </div>

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Electrical Contractor Address</legend>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="addressElectrician" name="Address (Electrician)" value="{{default['Address (Electrician)']}}" placeholder="Street Address" aria-label="street address">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="address2Electrician" name="Address 2 (Electrician)" value="{{default['Address 2 (Electrician)']}}" placeholder="Address Line 2" aria-label="address line 2">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-3">
                        <input type="text" class="form-control" id="cityElectrician" name="City (Electrician)" value="{{default['City (Electrician)']}}" placeholder="City" aria-label="city">
                    </div>
                    <div class="col-2">
                        <select class="form-select" id="stateElectrician" name="State (Electrician)" aria-label="electrician state">
                            <option hidden selected disabled>--- State ---</option>
                            {% for state in states %}
                                <option value="{{state}}" {% if (state == default['State (Electrician)']) %} selected="true" {% endif %}>{{state}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-3">
                        <input type="text" class="form-control" id="zipElectrician" name="Zip (Electrician)" value="{{default['Zip (Electrician)']}}" placeholder="Postal / Zip Code" aria-label="postal or zip code">
                    </div>
                </div>
            </fieldset>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="primaryPhoneElectrician" class="form-label">Electrical Contractor Primary Phone</label>
                    <input type="tel" class="form-control" id="primaryPhoneElectrician" name="Phone (Primary, Electrician)" value="{{default['Phone (Primary, Electrician)']}}">
                </div>
                <div class="col-4">
                    <label for="secondaryPhoneElectrician" class="form-label">Electrical Contractor Secondary Phone</label>
                    <input type="tel" class="form-control" id="secondaryPhoneElectrician" name="Phone (Secondary, Electrician)" value="{{default['Phone (Secondary, Electrician)']}}">
                </div>
            </div>

            <div class="row mb-3">
                <div class="col-4">
                    <label for="emailElectrician" class="form-label">Electrical Contractor Email</label>
                    <input type="email" class="form-control" id="emailElectrician" name="Email (Electrician)" value="{{default['Email (Electrician)']}}" onchange="ensureMemberIsNotContractor(this.id)">
                </div>
                <div class="col-4">
                    <label for="faxElectrician" class="form-label">Electrical Contractor Fax</label>
                    <input type="tel" class="form-control" id="faxElectrician" name="Fax (Electrician)" value="{{default['Fax (Electrician)']}}">
                </div>
            </div>
        </div>

        <!-- Script to show/hide electrician based on contractorIsElectrician checkbox -->
        <script type="text/javascript">
            const contractorIsElectrician = document.getElementById("contractorIsElectrician")
            const electrician = document.getElementById("electrician")
            const licenseBlock = document.getElementById("licenseBlock")
            contractorIsElectrician.addEventListener("click", () => {
                if (electrician.hasAttribute("hidden")) {
                    document.getElementById("electricianNameBlock").after(licenseBlock)
                    electrician.removeAttribute("hidden")
                } else {
                    document.getElementById("contractorNameBlock").after(licenseBlock)
                    electrician.setAttribute("hidden", "true")
                }
            })
        </script>

        <!-- Interconnection Service Block -->
        <div id="facility" class="mb-5">
            <h3 class="mb-3">Interconnection Service Information</h3>

            <div class="row mb-3">
                <div class="col-3">
                    <label for="accountNumber" class="form-label">Member Account Number</label>
                    <input type="text" class="form-control" id="accountNumber" name="Account Number" value="{{default['Account Number']}}">
                </div>
                <div class="col-5">
                    <label for="meterID" class="form-label">Meter ID</label>
                    <input type="text" class="form-control" id="meterID" name="Meter ID" value="{{default['Meter ID']}}">
                </div>
            </div>

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Service Address</legend>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="addressService" name="Address (Service)" value="{{default['Address (Service)']}}" placeholder="Street Address" aria-label="street address">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-6">
                        <input type="text" class="form-control" id="address2Service" name="Address 2 (Service)" value="{{default['Address 2 (Service)']}}" placeholder="Address Line 2" aria-label="address line 2">
                    </div>
                </div>
                <div class="row mb-2">
                    <div class="col-3">
                        <input type="text" class="form-control" id="cityService" name="City (Service)" value="{{default['City (Service)']}}" placeholder="City" aria-label="city">
                    </div>
                    <div class="col-2">
                        <select class="form-select" id="stateService" name="State (Service)" aria-label="service location state">
                            <option hidden selected disabled>--- State ---</option>
                            {% for state in states %}
                                <option value="{{state}}" {% if (state == default['State (Service)']) %} selected="true" {% endif %}>{{state}}</option>
                            {% endfor %}
                        </select>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-3">
                        <input type="text" class="form-control" id="zipService" name="Zip (Service)" value="{{default['Zip (Service)']}}" placeholder="Postal / Zip Code" aria-label="postal or zip code">
                    </div>
                </div>
            </fieldset>

            <fieldset class="mb-2">
                <legend class="col-form-label pt-0 pb-0 mb-2">Inverter Manufacturer & Model</legend>
                <div class="row mb-2">
                    <div class="col-3">
                        <select class="form-select" id="inverter" aria-label="inverter manufacturer and model">
                            <option hidden selected disabled>--- Select Inverter ---</option>
                            {% for manufacturer in inverters %}
                                <optgroup label="{{manufacturer}}">
                                    {% for model in inverters[manufacturer] %}
                                        <option value="{{model}}" {% if (default['Inverter Model'] == model) %} selected="true" {% endif %}>{{model}}</option>
                                    {% endfor %}
                                </optgroup>
                            {% endfor %}
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>
    
                <div id="inverterOther" hidden>
                    <div class="row mb-2">
                        <div class="col-3">
                            <input type="text" class="form-control" id="inverterManufacturer" name="Inverter Manufacturer" value="{{default['Inverter Manufacturer']}}" placeholder="Manufacturer" aria-label="inverter manufacturer">
                        </div>
                        <div class="col-3">
                            <input type="text" class="form-control" id="inverterModel" name="Inverter Model" value="{{default['Inverter Model']}}" placeholder="Model" aria-label="inverter model">
                        </div>
                    </div>
                    <div class="row mb-3">
                        <label for="inverterSpec" class="col-form-label col-2">Specification Sheet</label>
                        <div class="col-4">
                            <input type="file" class="form-control" id="inverterSpec" name="Inverter Specification" placeholder="Specification Sheet" aria-label="inverter specification sheet">
                        </div>
                    </div>
                </div>
            </fieldset>

            <!-- Script to show/hide manufacturer and model fields based on dropdown -->
            <script type="text/javascript">
                const inverter = document.getElementById("inverter")
                const inverterManufacturer = document.getElementById("inverterManufacturer")
                const inverterModel = document.getElementById("inverterModel")
                const inverterOther = document.getElementById("inverterOther")

                // populates inverter field for saved inverter not in dropdown
                if ((inverterManufacturer.value || inverterModel.value) && inverter.selectedIndex == 0) {
                    inverter.value = "Other"
                    inverterOther.removeAttribute("hidden")
                }

                inverter.addEventListener("change", () => {
                    const selected = inverter[inverter.selectedIndex]
                    const optgroup = selected.parentNode.label

                    if (selected.value == "Other") {
                        inverterManufacturer.value = ""
                        inverterModel.value = ""
                        inverterOther.removeAttribute("hidden")
                    } else {
                        inverterManufacturer.value = optgroup
                        inverterModel.value = selected.value
                        inverterOther.setAttribute("hidden", "true")
                    }
                })
            </script>

            <!-- <div class="row mb-3">
                <div class="col-2">
                    <label for="" class="form-label">AC Volts</label>
                    <select class="form-select" id="" name="" aria-label="">
                        <option value="First Choice" selected>First Choice</option>
                        <option value="Second Choice">Second Choice</option>
                        <option value="Third Choice">Third Choice</option>
                    </select>
                </div>
                <div class="col-2">
                    <label for="" class="form-label">kW (AC)</label>
                    <input type="text" class="form-control" id="" name="" value="">
                </div>
                <div class="col-2">
                    <label for="" class="form-label">Total kW (DC)</label>
                    <input type="text" class="form-control" id="" name="" value="">
                </div>
            </div> -->

            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-2">Nameplate Ratings</legend>
                <div class="row mb-2">
                    <div class="col-2">
                        <input type="text" class="form-control" id="nameplateRatingkW" name="Nameplate Rating (kW)" value="{{default['Nameplate Rating (kW)']}}" placeholder="kW-AC" aria-label="nameplate rating kilowatts AC">
                    </div>
                    <div class="col-2">
                        <input type="text" class="form-control" id="nameplateRatingkVA" name="Nameplate Rating (kVA)" value="{{default['Nameplate Rating (kVA)']}}" placeholder="kVA-AC" aria-label="nameplate rating kilovolt-amperes AC">
                    </div>
                    <div class="col-2">
                        <input type="text" class="form-control" id="nameplateRatingV" name="Nameplate Rating (V)" value="{{default['Nameplate Rating (V)']}}" placeholder="V-AC" aria-label="nameplate rating volts AC">
                    </div>
                </div>
            </fieldset>

            <div class="row mb-3">
                <!-- <div class="col-2">
                    <label for="" class="form-label">Number of panels</label>
                    <input type="text" class="form-control" id="" name="" value="">
                </div> -->

                <fieldset class="col-3">
                    <legend class="col-form-label pt-2">Is the equipment UL1741 listed?</legend>
                    <div class="form-check form-check-inline ms-1">
                        <input type="radio" class="form-check-input" id="yesListedRadio" name="UL1741 listed" value="Yes" {% if (default['UL1741 listed'] == 'Yes') %} checked="True" {% endif %}>
                        <label for="yesListedRadio" class="form-check-label">Yes</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="radio" class="form-check-input" id="noListedRadio" name="UL1741 listed" value="No" {% if (default['UL1741 listed'] == 'No') %} checked="True" {% endif %}>
                        <label for="noListedRadio" class="form-check-label">No</label>
                    </div>
                </fieldset>
            </div>

            <div class="row mb-3">
                <div class="col-3">
                    <label for="installDateEstimated" class="form-label">Estimated Install Date</label>
                    <input type="date" class="form-control" id="installDateEstimated" name="Estimated Install Date" value="{{default['Estimated Install Date']}}" min="">
                </div>

                <div class="col-3">
                    <label for="inServiceDateEstimated" class="form-label">Estimated In-Service Date</label>
                    <input type="date" class="form-control" id="inServiceDateEstimated" name="Estimated In-Service Date" value="{{default['Estimated In-Service Date']}}" min="">
                </div>
            </div>

            <div class="row mb-3">
                <fieldset class="col-3" id="tariffType">
                    <legend class="col-form-label pt-2">Tariff Type</legend>
                    <div class="form-check ms-1">
                        <input type="radio" class="form-check-input" id="netMeteringRadio" name="Tariff" value="Net metering" 
                            
                        >
                        <label for="netMeteringRadio" class="form-check-label">Net metering</label>
                    </div>
                    <div class="form-check ms-1">
                        <input type="radio" class="form-check-input" id="valueOfEnergyRadio" name="Tariff" value="Value of energy" 
                            
                        >
                        <label for="valueOfEnergyRadio" class="form-check-label">Value of energy</label>
                    </div>
                </fieldset>
                <!-- <fieldset class="col-3" id="netMeteringResetMonth">
                    <legend class="col-form-label pt-2">Net Metering kWh reset month</legend>
                    <div class="form-check form-check-inline ms-1">
                        <input type="radio" class="form-check-input" id="aprilRadio" name="Reset month" value="April kWh reset" 
                            
                        >
                        <label for="aprilRadio" class="form-check-label">April</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input type="radio" class="form-check-input" id="novemberRadio" name="Reset month" value="November kWh reset" 
                            
                        >
                        <label for="novemberRadio" class="form-check-label">November</label>
                    </div>
                </fieldset> -->
            </div>

            <!-- Script to remove or recreate April/Nov radio buttons on tariff button clicks -->
            <!-- Radio buttons could be hidden but not unchecked...bug? So remove them entirely to prevent submission of month with value of energy -->
            <script type="text/javascript">
                const tariffType = document.getElementById("tariffType")
                const netMeteringRadio = document.getElementById("netMeteringRadio")
                const valueOfEnergyRadio = document.getElementById("valueOfEnergyRadio")

                netMeteringRadio.addEventListener("click", () => {
                    let netMeteringResetMonth = document.querySelector("#netMeteringResetMonth")
                    if (!netMeteringResetMonth) {
                        netMeteringResetMonth = document.createElement("fieldset")
                        netMeteringResetMonth.className = "col-3"
                        netMeteringResetMonth.id = "netMeteringResetMonth"
                        
                        const legend = document.createElement("legend")
                        legend.className = "col-form-label pt-2"
                        legend.textContent = "Net Metering kWh reset month"
                        netMeteringResetMonth.appendChild(legend)
                        
                        const aprilGroup = document.createElement("div")
                        aprilGroup.className = "form-check form-check-inline ms-1"
                        const aprilInput = document.createElement("input")
                        aprilInput.type = "radio"
                        aprilInput.className = "form-check-input"
                        aprilInput.id = "aprilRadio"
                        aprilInput.name = "Reset month"
                        aprilInput.value = "April kWh reset"
                        aprilGroup.appendChild(aprilInput)
                        const aprilLabel = document.createElement("label")
                        aprilLabel.htmlFor = "aprilRadio"
                        aprilLabel.className = "form-check-label"
                        aprilLabel.textContent = "April"
                        aprilGroup.appendChild(aprilLabel)
                        netMeteringResetMonth.appendChild(aprilGroup)
                        
                        const novemberGroup = document.createElement("div")
                        novemberGroup.className = "form-check form-check-inline"
                        const novemberInput = document.createElement("input")
                        novemberInput.type = "radio"
                        novemberInput.className = "form-check-input"
                        novemberInput.id = "novemberRadio"
                        novemberInput.name = "Reset month"
                        novemberInput.value = "November kWh reset"
                        novemberGroup.appendChild(novemberInput)
                        const novemberLabel = document.createElement("label")
                        novemberLabel.htmlFor = "novemberRadio"
                        novemberLabel.className = "form-check-label"
                        novemberLabel.textContent = "November"
                        novemberGroup.appendChild(novemberLabel)
                        netMeteringResetMonth.appendChild(novemberGroup)

                        tariffType.after(netMeteringResetMonth)
                    }
                })
                valueOfEnergyRadio.addEventListener("click", () => {
                    const netMeteringResetMonth = document.querySelector("#netMeteringResetMonth")
                    if (netMeteringResetMonth) {
                        netMeteringResetMonth.remove()
                    }
                })
            </script>
            
        </div>

        <!-- Signature block -->
        <div id="signature" class="mb-5">
            <h3 class="mb-3">Terms</h3>
            <fieldset>
                <legend class="col-form-label pt-0 pb-0 mb-3 col-8">
                    By clicking the checkbox and typing their name below, the applicant agrees to provide the Cooperative with any additional information required to complete the interconnection. The applicant shall operate his equipment within the guidelines set forth by the cooperative.
                </legend>
                <div class="row mb-3">
                    <div class="form-check col-4 ms-3">
                        <input type="checkbox" class="form-check-input" id="agreement" name="Agreement">
                        <label for="agreement" class="form-check-label">I accept the terms above</label>
                    </div>
                </div>
                <div class="row mb-4">
                    <div class="col-3">
                        <input type="text" class="form-control" id="signed" name="Signed" placeholder="Your name here" aria-label="signature">
                    </div>
                </div>
            </fieldset>
            <button type="submit" class="btn btn-dark" id="submit">
                <span class="spinner-border spinner-border-sm me-2" id="submitSpinner" role="status" aria-hidden="true" hidden></span>
                Submit Application
            </button>
        </div>

        <!-- Script to display submit button spinner -->
        <script type="text/javascript">
            const submitSpinner = document.getElementById("submitSpinner")
            const submitButton = document.getElementById("submit")
            submitButton.addEventListener("click", () => {
                if (submitSpinner.hasAttribute("hidden")) {
                    submitSpinner.removeAttribute("hidden")
                }
                submitButton.childNodes[2].textContent = "Submitting Application..."
            })
        </script>

        <!-- Script to mask tel fields -->
        <script src="https://unpkg.com/vanilla-masker@1.1.1/lib/vanilla-masker.js"></script>
        <script type="text/javascript">
            const tels = document.querySelectorAll("input[type='tel']")
            Array.prototype.forEach.call(tels, function (tel) {
                tel.placeholder = "(xxx) xxx - xxxx"
                VMasker(tel).maskPattern("(999) 999 - 9999")
            })
        </script>

        <!-- Cleanup script on form submission -->
        <script type="text/javascript">
            function submitForm() {
                // unmasks tel inputs
                const tels = document.querySelectorAll("input[type='tel']")
                Array.prototype.forEach.call(tels, function (tel) {
                    VMasker(tel).unMask()
                })
                // removes alt contact fields if not shown
                const useAltContact = document.getElementById("useAltContact")
                if (!useAltContact.checked) {
                    document.getElementById("altContact").remove()
                }
                // combines tariff and month radio buttons
                const netMeteringRadio = document.getElementById("netMeteringRadio")
                if (netMeteringRadio.checked) {
                    const aprilRadio = document.querySelector("#aprilRadio")
                    const novemberRadio = document.querySelector("#novemberRadio")
                    if (aprilRadio.checked) {
                        netMeteringRadio.value += " " + aprilRadio.value
                    } else if (novemberRadio.checked) {
                        netMeteringRadio.value += " " + novemberRadio.value
                    }
                    const netMeteringResetMonth = document.querySelector("#netMeteringResetMonth")
                    if (netMeteringResetMonth) {
                        netMeteringResetMonth.remove()
                    }
                }
            }
        </script>

        <div class="card">
            <div class="card-body">
                <!--TODO: Figure out "same as member" button.-->
                <!--TODO: Decide if drop-down for partnered solar installers is good idea, maybe implement?-->
                <div class="form-group">
                    <h3 class="card-title">Installation Type</h3>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="radio" 
                            name="Installation Type" 
                            id="contractorElecRadio" 
                            value="Contractor and Electrician" 
                            onclick="showCorrectFormParts(this)"
                            {% if (default['Installation Type'] == 'Contractor and Electrician') %} checked="True" {% endif %}
                        >
                        <label class="form-check-label" for="contractorElecRadio">
                            Contractor and Electrician
                        </label>
                    </div>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="radio" 
                            name="Installation Type" 
                            id="contractorRadio" 
                            value="Contractor only" 
                            onclick="showCorrectFormParts(this)" 
                            {% if (default['Installation Type'] == 'Contractor only') %} checked="True" {% endif %}
                        >
                        <label class="form-check-label" for="contractorRadio">
                            Contractor only
                        </label>
                    </div>
                    <div class="form-check">
                        <input 
                            class="form-check-input" 
                            type="radio" 
                            name="Installation Type" 
                            id="selfRadio" 
                            value="Self-install" 
                            onclick="showCorrectFormParts(this)" 
                            {% if (default['Installation Type'] == 'Self-install') %} checked="True" {% endif %}
                        >
                        <label class="form-check-label" for="selfRadio">
                            Self-install
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="card">
            <div class="card-body">
                <div class="form-group">
                    <h3 class="card-title">Interconnection Service Information</h3>
               
                    <div class="form-group">
                        <label for="utility">Utility:</label>
                        <input type="text" class="form-control" id="utility" name="Utility" value="{{default['Utility']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="accountNumber">Account Number:</label>
                        <input type="text" class="form-control" id="accountNumber" name="Account Number" value="{{default['Account Number']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="meterID">Meter ID:</label>
                        <input type="text" class="form-control" id="meterID" name="Meter ID" value="{{default['Meter ID']}}">
                    </div>
                
                    <!--TODO: Allow drop-down for pre-certified inverters? Separate application?-->
                    <div class="form-group">
                        <label for="inverterManf">Inverter Manufacturer:</label>
                        <input type="text" class="form-control" id="inverterManf" name="Inverter Manufacturer" value="{{default['Inverter Manufacturer']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="inverterModel">Inverter Model:</label>
                        <input type="text" class="form-control" id="inverterModel" name="Inverter Model" value="{{default['Inverter Model']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="nameplateRatingkW">Nameplate Rating (kW-AC):</label>
                        <input type="text" class="form-control" id="nameplateRatingkW" name="Nameplate Rating (kW)" value="{{default['Nameplate Rating (kW)']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="nameplateRatingkVA">Nameplate Rating (kVA-AC):</label>
                        <input type="text" class="form-control" id="nameplateRatingkVA" name="Nameplate Rating (kVA)" value="{{default['Nameplate Rating (kVA)']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="nameplateRatingV">Nameplate Rating (V-AC):</label>
                        <input type="text" class="form-control" id="nameplateRatingV" name="Nameplate Rating (V)" value="{{default['Nameplate Rating (V)']}}">
                    </div>

                    <div class="form-group">
                        <label>Phases:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Phases" id="threePhaseRadio" value="Three" {% if (default['Phases'] == 'Three') %} checked="True" {% endif %}>
                            <label class="form-check-label" for="threePhaseRadio">Three</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="Phases" id="onePhaseRadio" value="One" {% if (default['Phases'] == 'One') %} checked="True" {% endif %}>
                            <label class="form-check-label" for="onePhaseRadio">One</label> 
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="primeMover">Prime Mover:</label>
                        <input type="text" class="form-control" id="primeMover" name="Prime Mover" value="{{default['Prime Mover']}}">
                    </div>
                
                    <!--TODO: Make dropdown or radio button-->
                    <div class="form-group">
                        <label for="energySource">Energy Source:</label>
                        <input type="text" class="form-control" id="energySource" name="Energy Source" value="{{default['Energy Source']}}">
                    </div>
                
                    <div class="form-group">
                        <label>Is the equipment UL1741 listed?:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="UL1741 listed" id="yesListedRadio" value="Yes" {% if (default['UL1741 listed'] == 'Yes') %} checked="True" {% endif %}>
                            <label class="form-check-label" for="yesListedRadio">Yes</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="UL1741 listed" id="noListedRadio" value="No" {% if (default['UL1741 listed'] == 'No') %} checked="True" {% endif %}>
                            <label class="form-check-label" for="noListedRadio">No</label>
                        </div>
                    </div>
                
                    <!--TODO: Date pickers-->
                    <div class="form-group">
                        <label for="installDateEstimated">Estimated Install Date:</label>
                        <input type="date" class="form-control" id="installDateEstimated" name="Estimated Install Date" value="{{default['Estimated Install Date']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="inServiceDateEstimated">Estimated In-Service Date:</label>
                        <input type="date" class="form-control" id="inServiceDateEstimated" name="Estimated In-Service Date" value="{{default['Estimated In-Service Date']}}">
                    </div>
                
                    <!--TODO: Table for Equipment - Certification-->
                </div>

                <div class="form-group">
                    <h3 class="card-title">Owner</h3>
            
                    <div class="form-group">
                        <label for="owner">Owner:</label>
                        <input type="text" class="form-control" id="owner" name="Owner" value="{{default['Owner']}}">
                    </div>
                    
                    <h3 class="card-title">Location</h3>
                    
                    <!--TODO: Figure out "same as above" button.-->
                    <div class="form-group">
                        <label for="addressService">Address:</label>
                        <input type="text" class="form-control" id="addressService" name="Address (Service)" value="{{default['Address (Service)']}}">
                    </div>
                
                    <div class="form-group">
                        <label for="cityService">City:</label>
                        <input type="text" class="form-control" id="cityService" name="City (Service)" value="{{default['City (Service)']}}">
                    </div>
                    
                    <div class="form-group">
                        <label for="stateService">State:</label>
                        <input type="text" class="form-control" id="stateService" name="State (Service)" value="{{default['State (Service)']}}">
                    </div>
                    
                    <div class="form-group">
                        <label for="zipService">Zip Code:</label>
                        <input type="text" class="form-control" id="zipService" name="Zip (Service)" value="{{default['Zip (Service)']}}">
                    </div>
                </div>
            </div>
        </div>
    </form>
{% endblock %}